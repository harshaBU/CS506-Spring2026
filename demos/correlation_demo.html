<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Correlation Coefficient Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .formula-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .formula {
            font-size: 2.2em;
            font-family: 'Times New Roman', serif;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .fraction {
            display: inline-block;
            vertical-align: middle;
        }
        
        .numerator {
            color: #e74c3c;
            font-size: 0.9em;
            margin-bottom: 2px;
        }
        
        .fraction-line {
            border-top: 2px solid #2c3e50;
            margin: 3px 0;
        }
        
        .denominator {
            color: #3498db;
            font-size: 0.9em;
            margin-top: 2px;
        }
        
        .explanation {
            font-size: 1.1em;
            color: #555;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .chart-section {
            margin-bottom: 50px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }
        
        .chart-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .correlation-slider {
            flex: 1;
            height: 8px;
            background: #ddd;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .correlation-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .correlation-value {
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .correlation-strength {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .strength-strong { background: #e8f5e8; color: #27ae60; }
        .strength-moderate { background: #fff3cd; color: #f39c12; }
        .strength-weak { background: #f8d7da; color: #e74c3c; }
        
        .three-point-demo {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
        }
        
        .three-point-demo h3 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .three-points-container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .three-point-plot {
            flex: 1;
            height: 200px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            position: relative;
        }
        
        .point {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #e74c3c;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .point-label {
            position: absolute;
            font-size: 0.8em;
            font-weight: bold;
            color: #2c3e50;
            transform: translate(-50%, -50%);
        }
        
        .mean-line {
            position: absolute;
            background: #3498db;
        }
        
        .mean-line.horizontal {
            height: 2px;
            width: 100%;
        }
        
        .mean-line.vertical {
            width: 2px;
            height: 100%;
        }
        
        .calculation-details {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .calculation-details h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .calculation-step {
            margin-bottom: 10px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .interactive-three-point {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #e74c3c;
        }
        
        .interactive-three-point h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
        }
        
        .interactive-container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }
        
        .interactive-plot-container {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .interactive-plot {
            width: 100%;
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 8px;
            position: relative;
            background: #fafafa;
        }
        
        .interactive-plot svg {
            width: 100%;
            height: 100%;
        }
        
        .draggable-point {
            cursor: move;
            transition: r 0.1s;
        }
        
        .draggable-point:hover {
            r: 8;
        }
        
        .diagonal-line {
            stroke: #95a5a6;
            stroke-width: 1;
            stroke-dasharray: 5,5;
            opacity: 0.5;
        }
        
        .correlation-panel {
            flex: 0 0 300px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .correlation-panel h3 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .correlation-display {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .correlation-value-large {
            font-size: 3em;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .correlation-strength-display {
            font-size: 1.2em;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .point-info {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .point-info strong {
            color: #2c3e50;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .action-button {
            flex: 1;
            padding: 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .action-button:hover {
            background: #2980b9;
        }
        
        .action-button.reset {
            background: #e74c3c;
        }
        
        .action-button.reset:hover {
            background: #c0392b;
        }
        
        .instructions {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 0.9em;
            color: #2c3e50;
        }
        
        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Interactive Correlation Coefficient Demo</h1>
            <p>Explore how correlation affects data relationships</p>
        </div>
        
        <div class="content">
            <!-- Correlation Formula Section -->
            <div class="formula-section">
                <div class="formula">
                    r = <span class="fraction">
                        <div class="numerator">Σ(x - x̄)(y - ȳ)</div>
                        <div class="fraction-line"></div>
                        <div class="denominator">√[Σ(x - x̄)² × Σ(y - ȳ)²]</div>
                    </span>
                </div>
                <div class="explanation">
                    <strong>What is Correlation?</strong><br>
                    Correlation measures how two variables change together. It's a ratio of how much the variables deviate from their means in the same direction (numerator) compared to their total individual variation (denominator). When r = +1, variables move perfectly together; when r = -1, they move in perfect opposition; when r = 0, there's no linear relationship.
                </div>
            </div>
            
            <!-- Interactive Three Point Demo -->
            <div class="interactive-three-point">
                <h2>Interactive Three-Point Correlation Explorer</h2>
                <div class="interactive-container">
                    <div class="interactive-plot-container">
                        <div class="interactive-plot" id="interactivePlot">
                            <svg id="plotSvg" viewBox="0 0 400 400" preserveAspectRatio="xMidYMid meet">
                                <!-- Grid lines -->
                                <defs>
                                    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                                        <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#ddd" stroke-width="0.5"/>
                                    </pattern>
                                </defs>
                                <rect width="100%" height="100%" fill="url(#grid)" />
                                
                                <!-- Axes -->
                                <line x1="40" y1="360" x2="360" y2="360" stroke="#2c3e50" stroke-width="2"/>
                                <line x1="40" y1="360" x2="40" y2="40" stroke="#2c3e50" stroke-width="2"/>
                                
                                <!-- Axis labels -->
                                <text x="200" y="390" text-anchor="middle" font-size="14" fill="#2c3e50">X</text>
                                <text x="15" y="200" text-anchor="middle" font-size="14" fill="#2c3e50" transform="rotate(-90 15 200)">Y</text>
                                
                                <!-- Diagonal line y=x -->
                                <line id="diagonalLine" x1="40" y1="360" x2="360" y2="40" class="diagonal-line"/>
                                
                                <!-- Points -->
                                <circle id="point0" class="draggable-point" cx="80" cy="320" r="6" fill="#e74c3c" stroke="#fff" stroke-width="2"/>
                                <circle id="point1" class="draggable-point" cx="200" cy="200" r="6" fill="#3498db" stroke="#fff" stroke-width="2"/>
                                <circle id="point2" class="draggable-point" cx="320" cy="80" r="6" fill="#27ae60" stroke="#fff" stroke-width="2"/>
                                
                                <!-- Point labels -->
                                <text id="label0" x="80" y="310" text-anchor="middle" font-size="12" fill="#2c3e50" font-weight="bold">P1</text>
                                <text id="label1" x="200" y="190" text-anchor="middle" font-size="12" fill="#2c3e50" font-weight="bold">P2</text>
                                <text id="label2" x="320" y="70" text-anchor="middle" font-size="12" fill="#2c3e50" font-weight="bold">P3</text>
                            </svg>
                        </div>
                        <div class="button-group">
                            <button class="action-button" onclick="snapToDiagonal()">Snap to y=x Line</button>
                            <button class="action-button reset" onclick="resetPoints()">Reset</button>
                        </div>
                    </div>
                    
                    <div class="correlation-panel">
                        <h3>Correlation Impact</h3>
                        <div class="correlation-display">
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Correlation Coefficient</div>
                            <div id="correlationValue" class="correlation-value-large">1.000</div>
                            <div id="correlationStrength" class="correlation-strength-display strength-strong">Perfect Positive</div>
                        </div>
                        
                        <div class="point-info">
                            <strong>Point 1 (Red):</strong><br>
                            <span id="point0Coords">(0.00, 0.00)</span>
                        </div>
                        <div class="point-info">
                            <strong>Point 2 (Blue):</strong><br>
                            <span id="point1Coords">(1.00, 1.00)</span>
                        </div>
                        <div class="point-info">
                            <strong>Point 3 (Green):</strong><br>
                            <span id="point2Coords">(2.00, 2.00)</span>
                        </div>
                        
                        <div class="instructions">
                            <strong>Instructions:</strong>
                            <ul>
                                <li>Drag any point to explore correlation</li>
                                <li>Points move in 0.01 increments</li>
                                <li>Watch correlation change in real-time</li>
                                <li>Use "Snap to y=x" to align points</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Linear Correlation Section -->
            <div class="chart-section">
                <h2>Linear Correlation: Study Hours vs GPA</h2>
                <div class="slider-container">
                    <label>Correlation Coefficient:</label>
                    <input type="range" class="correlation-slider" id="linearSlider" 
                           min="-1" max="1" step="0.01" value="0.8">
                    <div class="correlation-value" id="linearValue">0.80</div>
                </div>
                <div class="chart-container">
                    <canvas id="linearChart"></canvas>
                </div>
                <div class="stats-panel">
                    <div class="stat-card">
                        <div class="stat-label">R²</div>
                        <div class="stat-value" id="linearR2">0.64</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Slope</div>
                        <div class="stat-value" id="linearSlope">0.030</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Strength</div>
                        <div class="stat-value" id="linearStrength">Strong Positive</div>
                    </div>
                </div>
            </div>
            
            
            <!-- Categorical Correlation Section -->
            <div class="chart-section">
                <h2>Categorical Correlation: Income Level vs Satisfaction</h2>
                <div class="slider-container">
                    <label>Correlation Coefficient:</label>
                    <input type="range" class="correlation-slider" id="categoricalSlider" 
                           min="-1" max="1" step="0.01" value="0.6">
                    <div class="correlation-value" id="categoricalValue">0.60</div>
                </div>
                <div class="chart-container">
                    <canvas id="categoricalChart"></canvas>
                </div>
                <div class="stats-panel">
                    <div class="stat-card">
                        <div class="stat-label">R²</div>
                        <div class="stat-value" id="categoricalR2">0.36</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Eta²</div>
                        <div class="stat-value" id="categoricalEta2">0.36</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Strength</div>
                        <div class="stat-value" id="categoricalStrength">Moderate Positive</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let linearChart, categoricalChart;
        
        // Interactive three-point correlation demo
        let points = [
            { x: 0, y: 0, element: null },
            { x: 1, y: 1, element: null },
            { x: 2, y: 2, element: null }
        ];
        
        let draggingPoint = null;
        let dragOffset = { x: 0, y: 0 };
        
        // SVG coordinate system: viewBox is 0-400, but we map 0-3 for data
        const SVG_WIDTH = 400;
        const SVG_HEIGHT = 400;
        const PADDING = 40;
        const PLOT_WIDTH = SVG_WIDTH - 2 * PADDING;
        const PLOT_HEIGHT = SVG_HEIGHT - 2 * PADDING;
        const DATA_MIN = 0;
        const DATA_MAX = 2.5; // Allow some room beyond (2,2) for dragging
        
        function dataToSvgX(x) {
            return PADDING + ((x - DATA_MIN) / (DATA_MAX - DATA_MIN)) * PLOT_WIDTH;
        }
        
        function dataToSvgY(y) {
            return PADDING + PLOT_HEIGHT - ((y - DATA_MIN) / (DATA_MAX - DATA_MIN)) * PLOT_HEIGHT;
        }
        
        function svgToDataX(svgX) {
            return DATA_MIN + ((svgX - PADDING) / PLOT_WIDTH) * (DATA_MAX - DATA_MIN);
        }
        
        function svgToDataY(svgY) {
            return DATA_MIN + ((PLOT_HEIGHT - (svgY - PADDING)) / PLOT_HEIGHT) * (DATA_MAX - DATA_MIN);
        }
        
        function roundToStep(value, step) {
            return Math.round(value / step) * step;
        }
        
        function calculateCorrelation() {
            const x = points.map(p => p.x);
            const y = points.map(p => p.y);
            
            const n = points.length;
            const xMean = x.reduce((sum, val) => sum + val, 0) / n;
            const yMean = y.reduce((sum, val) => sum + val, 0) / n;
            
            let numerator = 0;
            let xVariance = 0;
            let yVariance = 0;
            
            for (let i = 0; i < n; i++) {
                const xDiff = x[i] - xMean;
                const yDiff = y[i] - yMean;
                numerator += xDiff * yDiff;
                xVariance += xDiff * xDiff;
                yVariance += yDiff * yDiff;
            }
            
            const denominator = Math.sqrt(xVariance * yVariance);
            const correlation = denominator === 0 ? 0 : numerator / denominator;
            
            return isNaN(correlation) ? 0 : correlation;
        }
        
        function updateCorrelationDisplay() {
            const correlation = calculateCorrelation();
            const correlationEl = document.getElementById('correlationValue');
            const strengthEl = document.getElementById('correlationStrength');
            
            correlationEl.textContent = correlation.toFixed(3);
            
            const absCorr = Math.abs(correlation);
            let strengthText, strengthClass;
            
            if (absCorr >= 0.99) {
                strengthText = correlation > 0 ? 'Perfect Positive' : 'Perfect Negative';
                strengthClass = 'strength-strong';
            } else if (absCorr >= 0.7) {
                strengthText = correlation > 0 ? 'Strong Positive' : 'Strong Negative';
                strengthClass = 'strength-strong';
            } else if (absCorr >= 0.5) {
                strengthText = correlation > 0 ? 'Moderate Positive' : 'Moderate Negative';
                strengthClass = 'strength-moderate';
            } else if (absCorr >= 0.3) {
                strengthText = correlation > 0 ? 'Weak Positive' : 'Weak Negative';
                strengthClass = 'strength-weak';
            } else {
                strengthText = 'Very Weak / No Correlation';
                strengthClass = 'strength-weak';
            }
            
            strengthEl.textContent = strengthText;
            strengthEl.className = `correlation-strength-display ${strengthClass}`;
        }
        
        function updatePointDisplay() {
            document.getElementById('point0Coords').textContent = `(${points[0].x.toFixed(2)}, ${points[0].y.toFixed(2)})`;
            document.getElementById('point1Coords').textContent = `(${points[1].x.toFixed(2)}, ${points[1].y.toFixed(2)})`;
            document.getElementById('point2Coords').textContent = `(${points[2].x.toFixed(2)}, ${points[2].y.toFixed(2)})`;
        }
        
        function updatePointPosition(index) {
            const point = points[index];
            const svgX = dataToSvgX(point.x);
            const svgY = dataToSvgY(point.y);
            
            point.element.setAttribute('cx', svgX);
            point.element.setAttribute('cy', svgY);
            
            const label = document.getElementById(`label${index}`);
            label.setAttribute('x', svgX);
            label.setAttribute('y', svgY - 15);
        }
        
        function initInteractivePlot() {
            const svg = document.getElementById('plotSvg');
            
            // Initialize point elements
            points[0].element = document.getElementById('point0');
            points[1].element = document.getElementById('point1');
            points[2].element = document.getElementById('point2');
            
            // Set initial positions
            points.forEach((point, index) => {
                updatePointPosition(index);
            });
            
            // Add event listeners for dragging
            points.forEach((point, index) => {
                point.element.addEventListener('mousedown', (e) => startDrag(e, index));
            });
            
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', endDrag);
            
            // Touch events for mobile
            points.forEach((point, index) => {
                point.element.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = svg.getBoundingClientRect();
                    const svgX = touch.clientX - rect.left;
                    const svgY = touch.clientY - rect.top;
                    startDrag({ clientX: touch.clientX, clientY: touch.clientY }, index, svgX, svgY);
                });
            });
            
            document.addEventListener('touchmove', (e) => {
                e.preventDefault();
                handleDrag(e.touches[0]);
            });
            
            document.addEventListener('touchend', endDrag);
            
            updateCorrelationDisplay();
            updatePointDisplay();
        }
        
        function startDrag(e, index, svgX = null, svgY = null) {
            draggingPoint = index;
            const svg = document.getElementById('plotSvg');
            const rect = svg.getBoundingClientRect();
            
            if (svgX === null || svgY === null) {
                svgX = e.clientX - rect.left;
                svgY = e.clientY - rect.top;
            }
            
            const point = points[index];
            const currentSvgX = dataToSvgX(point.x);
            const currentSvgY = dataToSvgY(point.y);
            
            dragOffset.x = svgX - currentSvgX;
            dragOffset.y = svgY - currentSvgY;
        }
        
        function handleDrag(e) {
            if (draggingPoint === null) return;
            
            const svg = document.getElementById('plotSvg');
            const rect = svg.getBoundingClientRect();
            const svgX = (e.clientX || e.touches?.[0]?.clientX || 0) - rect.left;
            const svgY = (e.clientY || e.touches?.[0]?.clientY || 0) - rect.top;
            
            const adjustedX = svgX - dragOffset.x;
            const adjustedY = svgY - dragOffset.y;
            
            // Convert to data coordinates
            let newX = svgToDataX(adjustedX);
            let newY = svgToDataY(adjustedY);
            
            // Round to 0.01 increments
            newX = roundToStep(newX, 0.01);
            newY = roundToStep(newY, 0.01);
            
            // Clamp to valid range
            newX = Math.max(DATA_MIN, Math.min(DATA_MAX, newX));
            newY = Math.max(DATA_MIN, Math.min(DATA_MAX, newY));
            
            // Update point
            const point = points[draggingPoint];
            point.x = newX;
            point.y = newY;
            
            updatePointPosition(draggingPoint);
            updateCorrelationDisplay();
            updatePointDisplay();
        }
        
        function endDrag() {
            draggingPoint = null;
        }
        
        function snapToDiagonal() {
            // Snap each point to y=x line
            points.forEach((point, index) => {
                // Calculate average of x and y, then set both to that value
                const avg = (point.x + point.y) / 2;
                const snapped = roundToStep(avg, 0.01);
                point.x = snapped;
                point.y = snapped;
                updatePointPosition(index);
            });
            updateCorrelationDisplay();
            updatePointDisplay();
        }
        
        function resetPoints() {
            points[0] = { x: 0, y: 0, element: points[0].element };
            points[1] = { x: 1, y: 1, element: points[1].element };
            points[2] = { x: 2, y: 2, element: points[2].element };
            
            points.forEach((point, index) => {
                updatePointPosition(index);
            });
            updateCorrelationDisplay();
            updatePointDisplay();
        }
        
        function generateLinearData(correlation, n = 100) {
            const data = [];
            const x = [];
            const y = [];
            
            // Generate x values (study hours 5-45)
            for (let i = 0; i < n; i++) {
                x.push(Math.random() * 40 + 5);
            }
            
            // Generate y values based on correlation
            for (let i = 0; i < n; i++) {
                const baseSlope = 0.03;
                const slope = correlation >= 0 ? baseSlope : -baseSlope;
                const baseGPA = 1.5;
                const trendY = baseGPA + slope * (x[i] - 25);
                
                let yValue;
                
                if (Math.abs(correlation) >= 0.99) {
                    // Perfect correlation: no noise at all
                    yValue = trendY;
                } else {
                    // Smooth transition based on correlation strength
                    const maxNoise = 0.8;
                    const noiseLevel = maxNoise * (1 - Math.abs(correlation));
                    const noise = (Math.random() - 0.5) * noiseLevel;
                    
                    // For very low correlations, add more randomness
                    const randomComponent = Math.random() * 3 + 0.5; // Random between 0.5 and 3.5
                    const trendWeight = Math.abs(correlation);
                    const randomWeight = 1 - trendWeight;
                    
                    yValue = (trendY + noise) * trendWeight + randomComponent * randomWeight;
                }
                
                y.push(Math.max(0.5, Math.min(3.5, yValue)));
            }
            
            return x.map((val, i) => ({ x: val, y: y[i] }));
        }
        
        
        function generateCategoricalData(correlation, n = 100) {
            const categories = ['Low', 'Medium-Low', 'Medium', 'Medium-High', 'High'];
            const categoryValues = [1, 2, 3, 4, 5];
            const data = [];
            
            // Generate equal samples per category
            const samplesPerCategory = Math.floor(n / categories.length);
            
            for (let i = 0; i < categories.length; i++) {
                const category = categories[i];
                const categoryValue = categoryValues[i];
                
                for (let j = 0; j < samplesPerCategory; j++) {
                    let satisfaction;
                    
                    if (Math.abs(correlation) >= 0.99) {
                        // Perfect correlation: no noise, clear progression
                        if (correlation > 0) {
                            // Perfect positive: Low=1, High=5
                            satisfaction = categoryValue;
                        } else {
                            // Perfect negative: Low=5, High=1
                            satisfaction = 6 - categoryValue;
                        }
                    } else {
                        // Smooth transition based on correlation strength
                        let baseSatisfaction = 3;
                        
                        // Adjust based on correlation
                        if (correlation > 0) {
                            // Positive correlation: higher income = higher satisfaction
                            baseSatisfaction = 2 + (categoryValue - 1) * 0.8;
                        } else if (correlation < 0) {
                            // Negative correlation: higher income = lower satisfaction
                            baseSatisfaction = 4 - (categoryValue - 1) * 0.8;
                        }
                        
                        // Add noise
                        const maxNoise = 1.5;
                        const noiseLevel = maxNoise * (1 - Math.abs(correlation));
                        const noise = (Math.random() - 0.5) * noiseLevel;
                        
                        // For very low correlations, add more randomness
                        const randomComponent = Math.random() * 4 + 1; // Random between 1 and 5
                        const trendWeight = Math.abs(correlation);
                        const randomWeight = 1 - trendWeight;
                        
                        satisfaction = (baseSatisfaction + noise) * trendWeight + randomComponent * randomWeight;
                    }
                    
                    satisfaction = Math.max(1, Math.min(5, satisfaction));
                    
                    data.push({
                        x: categoryValue,
                        y: satisfaction,
                        category: category
                    });
                }
            }
            
            return data;
        }
        
        function calculateStats(data) {
            const n = data.length;
            const x = data.map(d => d.x);
            const y = data.map(d => d.y);
            
            const xMean = x.reduce((sum, val) => sum + val, 0) / n;
            const yMean = y.reduce((sum, val) => sum + val, 0) / n;
            
            const numerator = x.reduce((sum, xi, i) => sum + (xi - xMean) * (y[i] - yMean), 0);
            const xVariance = x.reduce((sum, xi) => sum + Math.pow(xi - xMean, 2), 0) / n;
            const yVariance = y.reduce((sum, yi) => sum + Math.pow(yi - yMean, 2), 0) / n;
            
            const correlation = numerator / Math.sqrt(xVariance * yVariance * n * n);
            const rSquared = correlation * correlation;
            
            return { correlation, rSquared };
        }
        
        function getCorrelationStrength(correlation) {
            const abs = Math.abs(correlation);
            if (abs >= 0.7) return { text: 'Strong', class: 'strength-strong' };
            if (abs >= 0.5) return { text: 'Moderate', class: 'strength-moderate' };
            if (abs >= 0.3) return { text: 'Weak', class: 'strength-weak' };
            return { text: 'Very Weak', class: 'strength-weak' };
        }
        
        function initLinearChart() {
            const ctx = document.getElementById('linearChart').getContext('2d');
            const data = generateLinearData(0.8);
            
            linearChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Study Hours vs GPA',
                        data: data,
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Study Hours per Week',
                                font: { size: 14, weight: 'bold' }
                            },
                            grid: { color: 'rgba(0,0,0,0.1)' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'GPA (0-4 scale)',
                                font: { size: 14, weight: 'bold' }
                            },
                            min: 0.5,
                            max: 3.5,
                            grid: { color: 'rgba(0,0,0,0.1)' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Study Hours: ${context.parsed.x.toFixed(1)}, GPA: ${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        
        function initCategoricalChart() {
            const ctx = document.getElementById('categoricalChart').getContext('2d');
            const data = generateCategoricalData(0.6);
            
            // Group data by category for better visualization
            const groupedData = {};
            data.forEach(point => {
                if (!groupedData[point.category]) {
                    groupedData[point.category] = [];
                }
                groupedData[point.category].push(point);
            });
            
            const datasets = Object.keys(groupedData).map((category, index) => {
                const colors = [
                    'rgba(231, 76, 60, 0.6)',
                    'rgba(52, 152, 219, 0.6)',
                    'rgba(46, 204, 113, 0.6)',
                    'rgba(155, 89, 182, 0.6)',
                    'rgba(241, 196, 15, 0.6)'
                ];
                return {
                    label: category,
                    data: groupedData[category],
                    backgroundColor: colors[index % colors.length],
                    borderColor: colors[index % colors.length].replace('0.6', '1'),
                    borderWidth: 2,
                    pointRadius: 6,
                    pointHoverRadius: 8
                };
            });
            
            categoricalChart = new Chart(ctx, {
                type: 'scatter',
                data: { datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Income Level',
                                font: { size: 14, weight: 'bold' }
                            },
                            min: 0.5,
                            max: 5.5,
                            ticks: {
                                callback: function(value) {
                                    const labels = ['', 'Low', 'Medium-Low', 'Medium', 'Medium-High', 'High'];
                                    return labels[value] || '';
                                }
                            },
                            grid: { color: 'rgba(0,0,0,0.1)' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Satisfaction Score (1-5)',
                                font: { size: 14, weight: 'bold' }
                            },
                            min: 1,
                            max: 5,
                            grid: { color: 'rgba(0,0,0,0.1)' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function updateLinearChart(correlation) {
            const data = generateLinearData(correlation);
            linearChart.data.datasets[0].data = data;
            
            const stats = calculateStats(data);
            document.getElementById('linearR2').textContent = stats.rSquared.toFixed(3);
            
            const baseSlope = 0.03;
            const actualSlope = correlation >= 0 ? baseSlope : -baseSlope;
            document.getElementById('linearSlope').textContent = actualSlope.toFixed(3);
            
            const strength = getCorrelationStrength(correlation);
            const strengthEl = document.getElementById('linearStrength');
            strengthEl.textContent = `${strength.text} ${correlation >= 0 ? 'Positive' : 'Negative'}`;
            strengthEl.className = `correlation-strength ${strength.class}`;
            
            linearChart.update();
        }
        
        
        function updateCategoricalChart(correlation) {
            const data = generateCategoricalData(correlation);
            
            // Group data by category
            const groupedData = {};
            data.forEach(point => {
                if (!groupedData[point.category]) {
                    groupedData[point.category] = [];
                }
                groupedData[point.category].push(point);
            });
            
            const datasets = Object.keys(groupedData).map((category, index) => {
                const colors = [
                    'rgba(231, 76, 60, 0.6)',
                    'rgba(52, 152, 219, 0.6)',
                    'rgba(46, 204, 113, 0.6)',
                    'rgba(155, 89, 182, 0.6)',
                    'rgba(241, 196, 15, 0.6)'
                ];
                return {
                    label: category,
                    data: groupedData[category],
                    backgroundColor: colors[index % colors.length],
                    borderColor: colors[index % colors.length].replace('0.6', '1'),
                    borderWidth: 2,
                    pointRadius: 6,
                    pointHoverRadius: 8
                };
            });
            
            categoricalChart.data.datasets = datasets;
            
            const stats = calculateStats(data);
            document.getElementById('categoricalR2').textContent = stats.rSquared.toFixed(3);
            document.getElementById('categoricalEta2').textContent = stats.rSquared.toFixed(3);
            
            const strength = getCorrelationStrength(correlation);
            const strengthEl = document.getElementById('categoricalStrength');
            strengthEl.textContent = `${strength.text} ${correlation >= 0 ? 'Positive' : 'Negative'}`;
            strengthEl.className = `correlation-strength ${strength.class}`;
            
            categoricalChart.update();
        }
        
        // Initialize everything when page loads
        window.addEventListener('load', function() {
            initInteractivePlot();
            initLinearChart();
            initCategoricalChart();
            
            // Set up event listeners
            document.getElementById('linearSlider').addEventListener('input', function() {
                const correlation = parseFloat(this.value);
                document.getElementById('linearValue').textContent = correlation.toFixed(2);
                updateLinearChart(correlation);
            });
            
            document.getElementById('categoricalSlider').addEventListener('input', function() {
                const correlation = parseFloat(this.value);
                document.getElementById('categoricalValue').textContent = correlation.toFixed(2);
                updateCategoricalChart(correlation);
            });
        });
    </script>
</body>
</html>
